@page "/Clientes/Create"
@inject ClienteServices clienteServices
@inject NavigationManager NavigationManager

<h3>Nuevo Cliente</h3>

<EditForm Model="cliente" OnValidSubmit="GuardarCliente">
    <DataAnnotationsValidator />
    <ValidationSummary />

    <div class="mb-3">
        <label for="clienteId" class="form-label">Seleccione Cliente</label>
        <select id="clienteId" @bind="cliente.ClienteId" class="form-control">
            <option value="">-- Seleccione un Cliente --</option>
            @foreach (var c in clientes)
            {
                <option value="@c.ClienteId">@c.Nombres</option>
            }
        </select>
    </div>

    <div class="mb-3">
        <label for="nombres" class="form-label">Nombres</label>
        <InputText id="nombres" @bind-Value="cliente.Nombres" class="form-control" required />
    </div>

    <div class="mb-3">
        <label for="rnc" class="form-label">RNC</label>
        <InputText id="rnc" @bind-Value="cliente.Rnc" class="form-control" required />
    </div>

    <div class="mb-3">
        <label for="direccion" class="form-label">Dirección</label>
        <InputText id="direccion" @bind-Value="cliente.Direccion" class="form-control" required />
    </div>

    <div class="mb-3">
        <label for="limiteCredito" class="form-label">Límite de Crédito</label>
        <InputNumber id="limiteCredito" @bind-Value="cliente.LimiteCredito" class="form-control" required />
    </div>

    <div class="mb-3">
        <label>Teléfonos</label>
        @foreach (var telefono in cliente.Telefonos)
        {
            <div class="input-group mb-2">
                <InputNumber placeholder="Tipo de Teléfono" @bind-Value="telefono.TipoId" class="form-control" />
                <InputText placeholder="Teléfono" @bind-Value="telefono.Telefono" class="form-control" />
                <button type="button" class="btn btn-danger" @onclick="() => EliminarTelefono(telefono)">Eliminar</button>
            </div>
        }
        <button type="button" class="btn btn-success" @onclick="AgregarTelefono">Agregar Teléfono</button>
    </div>

    <button type="submit" class="btn btn-primary"><i class="fas fa-save"></i> Guardar</button>
    <button type="button" class="btn btn-secondary" @onclick="Cancelar"><i class="fas fa-times"></i> Cancelar</button>
</EditForm>

@code {
    private Cliente cliente = new Cliente();
    private List<Cliente> clientes = new List<Cliente>(); // Lista para almacenar los clientes

    protected override async Task OnInitializedAsync()
    {
        // Cargar la lista de clientes al iniciar la página
        clientes = await clienteServices.Listar();
    }

    private async Task GuardarCliente()
    {
        await clienteServices.Guardar(cliente);
        NavigationManager.NavigateTo("/Clientes/Index");
    }

    private void Cancelar()
    {
        NavigationManager.NavigateTo("/Clientes/Index");
    }

    private void AgregarTelefono()
    {
        cliente.Telefonos.Add(new ClientesDetalle());
    }

    private void EliminarTelefono(ClientesDetalle telefono)
    {
        cliente.Telefonos.Remove(telefono);
    }
}
